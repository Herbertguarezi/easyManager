<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de Produto com Imagem</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; }
    input, button { display: block; margin-bottom: 15px; padding: 8px; width: 100%; }
    img { max-width: 300px; margin-top: 20px; display: none; }
  </style>
</head>
<body>

  <h2>Cadastro de Produto</h2>

  <form id="productForm">
    <input type="text" name="name" id="name" placeholder="Nome do Produto" required>
    <input type="number" name="amount" id="amount" placeholder="Quantidade" required>
    <input type="file" name="file" id="file" accept="image/*" required>
    <button type="submit">Enviar Produto</button>
  </form>

  <div id="result"></div>
  <img id="previewImage" src="">


  <button id="produtos">Produtos</button>

  <script>
    const form = document.getElementById('productForm');
    const resultDiv = document.getElementById('result');
    const previewImage = document.getElementById('previewImage');

    const produtos = document.getElementById("produtos")

    produtos.addEventListener("click", () => {
        fetch("http://localhost:8080/products")
        .then(r => r.json())
        .then(j => console.log(j))
    })

    produtos

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const amount = document.getElementById('amount').value;
      const file = document.getElementById('file').files[0];

      const formData = new FormData();
      formData.append("name", name);
      formData.append("amount", amount);
      formData.append("file", file);

      try {
        const res = await fetch("http://localhost:8080/products", {
          method: "POST",
          body: formData
        });

        const data = await res.json();

        if (res.ok) {
          resultDiv.innerHTML = `<strong>Produto salvo com sucesso!</strong><br>ID: ${data.id}<br>Nome: ${data.name}`;
          previewImage.src = data.photoUrl;
          previewImage.style.display = "block";
        } else {
          resultDiv.innerText = "Erro ao salvar: " + JSON.stringify(data);
        }

      } catch (err) {
        resultDiv.innerText = "Erro na requisição: " + err.message;
      }
    });
  </script>

</body>
</html>
